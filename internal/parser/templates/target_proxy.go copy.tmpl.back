// Code generated by simple-gen-proxy. DO NOT EDIT.
// source: {{.SourceFile}}

package {{.PackageName}}

import (
    "database/sql"

    {{range .Imports -}}
    {{.Alias}} "{{.Path}}"
    {{end}}
)

{{range .Interfaces}}

type {{.ProxyTypeName}}Helper func(c context.Context, f func(c context.Context) error) error

type {{.ProxyTypeName}} struct {
    target {{if .IsDiffrentPackage}}{{.InterfacePakcage}}.{{end}}{{.InterfaceName}}
    helper {{.ProxyTypeName}}Helper
}

func New{{.ProxyTypeName}}(target {{if .IsDiffrentPackage}}{{.InterfacePakcage}}.{{end}}{{.InterfaceName}}, helper {{.ProxyTypeName}}Helper) *{{.ProxyTypeName}} {
    return &{{.ProxyTypeName}}{
        target: target,
        helper: helper,
    }
}

{{range .Methods}}
func (p *{{.ProxyTypeName}}) {{.Name}}({{.Params}}) {{.ResultTypes}} {
    {{if .IsTransaction -}}
        {{if .HasResults -}}
            var (
            {{range .Results}}
                {{.ResultVar}} {{.ResultType -}}
            {{end}}
            )
        {{end}}

        err = p.helper({{.UserContextParam}}, func({{.HelperContextParam}} context.Context) error {
        {{if .HasResults -}}
            {{.ResultVars}} = p.target.{{.Name}}({{.ParamNamesWithHelperContext}})
            if err != nil {
                return err
            }
        {{else -}}
            p.target.{{.Name}}({{.ParamNames}})
        {{end -}}
            return nil
        })

        {{if .HasResults -}}
            return {{.ResultVars}}
        {{end -}}
    {{else if .IsProxy -}}
        {{if .HasResults -}}
            var (
            {{range .Results}}
                {{.ResultVar}} {{.ResultType -}}
            {{end}}
            )
        {{end}}
        
        err = p.helper(context.Background(), func(_ context.Context) error {
        {{if .HasResults -}}
            {{.ResultVars}} = p.target.{{.Name}}({{.ParamNames}})
            if err != nil {
                return err
            }
        {{else -}}
            p.target.{{.Name}}({{.ParamNames}})
        {{end -}}
            return nil
        })

        {{if .HasResults -}}
            return {{.ResultVars}}
        {{end -}}
    {{else -}}
        {{if .HasResults}} return {{end}} p.target.{{.Name}}({{.ParamNames}})
    {{end -}}
}
{{end}}
{{end}}